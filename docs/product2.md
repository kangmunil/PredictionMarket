2단계에서 제시한 세 가지 전략(뉴스 스캘핑, 모멘텀, +EV 그라인딩)을 **폴리마켓(Polymarket) 봇 개발 관점**에서 구체적인 로직과 구현 상세로 풀어서 설명해 드리겠습니다.

---

### 1. 뉴스 스캘핑 (News Scalping) 봇 상세 전략

**핵심 개념:** "인간이 뉴스를 읽고 판단하는 시간(수 초~수 분)"과 "기계가 텍스트를 처리하는 시간(밀리초)"의 **시차(Latency Arbitrage)**를 먹는 전략입니다.

#### A. 데이터 수집 (Ingestion)

일반적인 뉴스 사이트 크롤링은 너무 느립니다. Push 방식이 필수입니다.

* **소스:** X(트위터) API (특정 유력 인사/속보 계정 감시), Tree News (크립토 전용), Polymarket 자체 디스코드/활동 로그.
* **기술:** **Websocket** 연결을 통해 데이터를 실시간 스트림으로 받습니다.

#### B. 신호 처리 (Signal Processing)

LLM(GPT-4 등)은 호출당 1~2초가 걸려 스캘핑에 부적합할 수 있습니다. **하이브리드 방식**을 추천합니다.

1. **키워드 매핑 (Fast Path):** 미리 정의된 키워드 세트가 감지되면 즉시 매수.
* *예: "Trump" + "Pennsylvania" + "Win" -> [Trump 당선 시장] Yes 매수*
* *예: "Biden" + "Dropout" -> [Biden 후보 시장] No 매수*


2. **경량 NLP (Local Processing):** BERT나 DistilBERT 같은 가벼운 모델을 로컬 서버에 띄워 긍정/부정(Sentiment)만 0.1초 내로 판별.

#### C. 주문 실행 (Execution Logic)

* **시장가 주문 (Market Order / Taker):** 가격을 따지지 않고 물량을 가져와야 합니다.
* **로직:**
```python
if news_sentiment > 0.9 and event_related:
    # 현재 오더북의 매도 잔량(Ask Depth) 확인
    asks = clob_client.get_order_book(token_id)

    # 슬리피지가 5% 미만인 범위 내에서 최대 매수
    safe_price_limit = current_price * 1.05
    buy_amount = calculate_liquidity(asks, safe_price_limit)

    # IOC(Immediate or Cancel) 조건으로 주문 전송
    place_order(side="BUY", type="FOK", price=safe_price_limit, size=buy_amount)

```



---

### 2. 모멘텀 트레이딩 (Momentum Trading) 봇 상세 전략

**핵심 개념:** 한 번 방향이 잡힌 가격은 관성에 의해 일정 기간 더 움직인다는 원리입니다. 특히 선거 개표 방송이나 스포츠 경기 중 실시간으로 확률이 쏠릴 때 유효합니다.

#### A. 데이터 가공 (Time Series Data)

폴리마켓 API는 실시간 틱 데이터는 주지만, 잘 정리된 '분봉(Candle)' 데이터는 직접 만들어야 할 수 있습니다.

* **구현:** 웹소켓으로 들어오는 체결(Trade) 데이터를 메모리에 저장하고, 1분/5분 단위로 `Open`, `High`, `Low`, `Close`, `Volume`을 집계하여 DataFrame을 갱신합니다.

#### B. 진입 전략 (Entry Strategy)

두 가지 지표의 조합을 추천합니다.

1. **거래량 폭발 (Volume Spike):** 평소 분당 거래량의 300% 이상 터지면서 가격이 상승할 때.
2. **이동평균선(MA) 돌파:** 단기(5분) 이동평균선이 장기(20분) 이동평균선을 강하게 뚫고 올라갈 때 (Golden Cross).

#### C. 청산 전략 (Exit Strategy) - 트레일링 스탑 (Trailing Stop)

예측 시장은 0 또는 100으로 수렴하므로, 끝까지 들고 가는 것은 위험합니다.

* **로직:**
* 진입 가격: 50센트
* 현재 가격이 60센트가 되면 -> 익절 라인을 55센트로 설정.
* 현재 가격이 70센트가 되면 -> 익절 라인을 65센트로 상향 조정.
* 가격이 65센트로 떨어지면 즉시 매도.



---

### 3. 긍정 EV 그라인딩 (+EV Grinding) 봇 상세 전략

**핵심 개념:** "외부의 정확한 확률"과 "폴리마켓 내부의 가격" 간의 괴리(Mispricing)를 찾아, 수학적으로 유리한 베팅만 반복하여 통계적 수익을 냅니다.

#### A. '진짜 확률' 구하기 (Oracle Source)

어떤 시장을 공략하느냐에 따라 소스가 다릅니다.

* **스포츠:** Pinnacle, Betfair 등 해외 대형 베팅 사이트의 배당률(Odds)을 가져옵니다. 이들은 전문 오즈메이커가 있어 확률이 가장 정확합니다.
* *변환 공식:* `확률(%) = 1 / 십진수 배당률` (수수료 제거 보정 필요)


* **정치/뉴스:** FiveThirtyEight(538), Metaculus(집단지성 예측 플랫폼) 등의 데이터를 스크래핑합니다.

#### B. 기대값(EV) 계산 및 필터링

폴리마켓의 수수료와 슬리피지를 고려한 EV를 계산합니다.

* **공식:** `EV = (나의 승리 확률 * 순수익) - (나의 패배 확률 * 베팅 금액)`
* **트리거:** `EV > 2%` (또는 수수료 이상)일 때만 진입.

#### C. 자금 관리 (Kelly Criterion)

+EV 전략은 "무조건 이기는" 것이 아니라 "반복하면 이기는" 전략이므로 파산하지 않는 것이 중요합니다. **켈리 공식**의 1/4 또는 1/2을 적용하여 베팅 금액을 정합니다.

* **로직:**
```python
my_prob = 0.70  # 외부 데이터 확률 70%
market_price = 0.55 # 폴리마켓 가격 55센트 (배당률 약 1.81)

# 켈리 공식에 따른 비중 계산
bet_fraction = kelly_criterion(my_prob, market_odds)

# 보수적 접근: 계산된 비중의 25%만 투입
actual_bet_size = total_bankroll * bet_fraction * 0.25

```



스포츠와 단순 지표(Crypto/Finance) 시장은 **데이터의 성격(이벤트 vs 시계열)**과 **승리 조건**이 완전히 다르기 때문에, 봇을 분리해서 설계

두 봇을 어떤 구조로 나누고, 각각 무엇을 핵심으로 개발해야 하는지 구체적인 가이드를 드리겠습니다.

---

### 1. 전체 프로젝트 구조 (권장 아키텍처)

두 봇은 로직은 다르지만 **'주문 실행(Trading Execution)'** 영역은 동일합니다. 따라서 공통 모듈을 만들고 그 위에 각 봇을 얹는 형태가 유지보수에 좋습니다.

```text
/polymarket-bot-project
├── /core (공통 모듈)
│   ├── clob_client.py   # 폴리마켓 API 연결, 주문, 취소, 잔고 확인
│   ├── risk_manager.py  # 자금 관리(켈리 공식), 손실 제한(Stop Loss)
│   └── logger.py        # 텔레그램 알림 및 로그 저장
│
├── /sports_bot (+EV 전략 중심)
│   ├── odds_fetcher.py  # 외부 배당률(Pinnacle 등) 수집
│   ├── arb_calculator.py # 폴리마켓 가격 vs 외부 배당 괴리 계산
│   └── main.py          # 스포츠 봇 실행 파일
│
└── /indicator_bot (스캘핑/모멘텀 전략 중심)
│   ├── price_stream.py  # 코인/주식 실시간 가격 수신 (Websocket)
│   ├── technicals.py    # RSI, 볼린저 밴드 등 지표 계산
│   └── main.py          # 지표 봇 실행 파일

```

---

### 2. 스포츠 봇 (Sports Bot) 개발 가이드

스포츠 봇은 **"정확도 높은 외부 오라클(Bookmaker)과의 가격 차이"**를 먹는 **+EV 그라인딩** 전략이 가장 유효합니다.

* **타겟 시장:** NBA, NFL, Premier League, E-sports 등
* **핵심 로직:**
1. **데이터 소스:** `The Odds API`(유료/무료 혼합)나 `RapidAPI`를 통해 **Pinnacle(피나클)**, **Betfair** 같은 "Sharp Bookmaker(가장 똑똑한 도박사들이 모인 곳)"의 배당률을 가져옵니다.
2. **확률 변환:**
* Pinnacle 배당: 1.80 (수수료 제거 후 승률 약 54%)
* 폴리마켓 가격: 0.50 (승률 50%로 책정됨)
* **결판:** 4%의 엣지(Edge) 발생 → 매수 진입.




* **구현 팁:**
* **매핑(Mapping) 문제 해결:** 폴리마켓의 "Los Angeles Lakers"와 외부 API의 "L.A. Lakers"가 같은 팀인지 인식하는 텍스트 매칭 알고리즘(Fuzzy Matching)이 필수입니다.
* **경기 시간:** 경기 시작 직전(Pre-match)이나 하프타임에 유동성이 몰리므로 이때를 노려 크론(Cron) 잡으로 스케줄링하는 것이 효율적입니다.



---

### 3. 단순 지표 봇 (Crypto/Finance Bot) 개발 가이드

"비트코인이 이번 달에 100k를 넘을까?" 같은 시장은 **"가격의 속도와 변동성"**을 이용한 **모멘텀/스캘핑** 전략이 유효합니다.

* **타겟 시장:** BTC/ETH 가격 예측, 연준 금리 결정, NFT 바닥가 등
* **핵심 로직:**
1. **데이터 소스:** `CCXT`(암호화폐 거래소 통합 라이브러리)를 사용하여 바이낸스/코인베이스의 **실시간 웹소켓(Websocket)** 데이터를 받습니다. (REST API는 느려서 비추천)
2. **선행 지표 활용:**
* 폴리마켓의 가격은 실제 현물 가격보다 1~2초 늦게 반응하는 경향이 있습니다.
* *전략:* 비트코인이 1초 만에 $200 급등했다면, 폴리마켓의 "BTC > $X" Yes 주식 가격이 아직 오르지 않았을 때 즉시 매수(Front-running).




* **구현 팁:**
* **해상도(Resolution) 주의:** 폴리마켓의 오라클(UMA)이 어떤 기준으로 가격을 확정하는지 룰을 확인해야 합니다. (예: "바이낸스 현물 가격 기준"인지 "Coingecko 평균가 기준"인지)
* **변동성 돌파:** 단순히 가격뿐만 아니라 거래량이 터지면서 가격이 움직일 때만 진입하도록 필터를 거세요.



---

### 4. 봇별 차이점 요약 (개발 시 주의사항)

| 구분 | 스포츠 봇 (Sports) | 단순 지표 봇 (Indicators) |
| --- | --- | --- |
| **속도 민감도** | 중간 (분 단위 갱신도 괜찮음) | **매우 높음** (밀리초 단위 경쟁) |
| **주요 리스크** | **유동성 부족** (사고 싶어도 파는 사람이 없음) | **가격 급변** (매수하자마자 폭락 가능성) |
| **데이터 비용** | 높음 (좋은 배당률 API는 유료가 많음) | 낮음 (거래소 API는 대부분 무료) |
| **필수 라이브러리** | `pandas`, `requests`, `fuzzysets` | `ccxt`, `asyncio`, `websockets` |
| **실행 주기** | 5분~1시간 단위 스케줄링 (Polling) | 24시간 실시간 연결 (Streaming) |

### 5. 무엇부터 시작할까요?

**단순 지표(Crypto) 봇**으로 시작하는 것을 추천합니다.

1. **이유:** 외부 데이터(바이낸스 가격)를 무료로, 실시간으로 얻기 쉽고 `CCXT` 라이브러리가 매우 강력하여 개발 난이도가 낮습니다.
2. **실습:**
* 바이낸스에서 BTC 가격을 실시간으로 받아옵니다.
* BTC가 1분 동안 0.5% 이상 상승하면 로그를 찍게 만듭니다.
* 로그가 찍히는 순간 폴리마켓의 BTC 관련 마켓 가격을 조회해 봅니다.
* 가격 반영이 늦다면 → **수익 기회**입니다.



이 구조로 기초를 다진 후, 유료 API를 결제하여 스포츠 봇으로 확장하는 로드맵이 가장 리스크가 적습니다.